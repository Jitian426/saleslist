{% extends "base.html" %}
{% load static %}
{% block title %}æ—¥æ¬¡KPIï¼ˆæ‹…å½“è€…åˆ¥ï¼‰{% endblock %}

{% block content %}
<div class="container-fluid py-3">

  <div class="d-flex align-items-center justify-content-between mb-3 flex-wrap gap-2">
    <h3 class="m-0">æ—¥æ¬¡KPIï¼ˆæ‹…å½“è€…åˆ¥ï¼‰</h3>
    <div class="d-flex align-items-center gap-2">
      <form class="d-flex" method="get" role="search">
        <input type="date" class="form-control me-2" name="d" value="{{ target_date|date:'Y-m-d' }}">
        <button type="submit" class="btn btn-primary">è¡¨ç¤º</button>
      </form>
      <a href="{% url 'saleslist:monthly_kpi' %}" class="btn btn-outline-secondary">
        ğŸ“… æœˆæ¬¡KPIã¸
      </a>
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle m-0">
          <thead class="table-light" style="position: sticky; top: 0; z-index: 1;">
            <tr>
              <th style="white-space:nowrap;">å–¶æ¥­æ‹…å½“è€…</th>
              <th class="text-end">ã‚³ãƒ¼ãƒ«æ•°</th>
              <th class="text-end">ãƒ’ãƒƒãƒˆæ•°</th>
              <th class="text-end">ãƒ’ãƒƒãƒˆç‡</th>
              <th class="text-end">æ±ºè£è€…ã‚³ãƒ³ã‚¿ã‚¯ãƒˆæ•°</th>
              <th class="text-end">æ±ºè£è€…ç‡</th>
              <th class="text-end">è¦‹è¾¼æ•°</th>
              <th class="text-end">è¦‹è¾¼ç‡</th>
              <th class="text-end">ã‚¢ãƒæˆç«‹æ•°</th>
              <th class="text-end">ã‚¢ãƒç‡</th>
            </tr>
          </thead>
          <tbody>
            {% for r in rows %}
            <tr>
              <td style="white-space:nowrap;">{{ r.name }}</td>
              <td class="text-end">{{ r.calls }}</td>
              <td class="text-end">{{ r.hits }}</td>
              <td class="text-end"><span class="badge bg-opacity-25 bg-success text-success fw-normal">{{ r.hit_rate|floatformat:1 }}%</span></td>
              <td class="text-end">{{ r.decisions }}</td>
              <td class="text-end">{{ r.decision_rate|floatformat:1 }}%</td>
              <td class="text-end">{{ r.mikomi }}</td>
              <td class="text-end">{{ r.mikomi_rate|floatformat:1 }}%</td>
              <td class="text-end">{{ r.apo }}</td>
              <td class="text-end"><strong>{{ r.apo_rate|floatformat:1 }}%</strong></td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="10" class="text-center text-muted py-4">å¯¾è±¡ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td>
            </tr>
            {% endfor %}
          </tbody>
          <tfoot class="table-secondary">
            <tr>
              <th>åˆè¨ˆ</th>
              <th class="text-end">{{ totals.calls }}</th>
              <th class="text-end">{{ totals.hits }}</th>
              <th class="text-end">{{ totals.hit_rate|floatformat:1 }}%</th>
              <th class="text-end">{{ totals.decisions }}</th>
              <th class="text-end">{{ totals.decision_rate|floatformat:1 }}%</th>
              <th class="text-end">{{ totals.mikomi }}</th>
              <th class="text-end">{{ totals.mikomi_rate|floatformat:1 }}%</th>
              <th class="text-end">{{ totals.apo }}</th>
              <th class="text-end">{{ totals.apo_rate|floatformat:1 }}%</th>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>

  <div class="d-flex justify-content-between align-items-center mt-3">
    <div class="text-muted small">è¡¨ç¤ºæ—¥ï¼š{{ target_date|date:"Yå¹´næœˆjæ—¥" }}</div>
    <div class="d-flex gap-2">
      <a href="/dashboard/" class="btn btn-outline-secondary btn-sm">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
      {# CSVå‡ºåŠ›ã¯å¾Œæ—¥URLã‚’ä½œæˆ #}
      {# <a href="{% url 'daily_kpi_csv' %}?d={{ target_date|date:'Y-m-d' }}" class="btn btn-outline-primary btn-sm">CSVå‡ºåŠ›</a> #}
    </div>
  </div>
</div>
{% endblock %}
