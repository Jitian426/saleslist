<!DOCTYPE html>
<html lang="ja">
<head>
    <!-- Bootstrap 5 ã®CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼šç¤¾ãƒªã‚¹ãƒˆ</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;  /* âœ… æ–‡å­—ã‚µã‚¤ã‚ºã‚’å°ã•ãã—ã¦å…¨æƒ…å ±ãŒåã¾ã‚‹ã‚ˆã†ã« */
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
            word-wrap: break-word;
        }
        th {
            background-color: #f2f2f2;
        }
        .address {
            max-width: 300px;  /* âœ… åº—èˆ—ä½æ‰€ã¯é•·ã‚ã« */
            word-wrap: break-word;
            white-space: normal;
        }
    </style>
</head>
<body>
    <h2>ä¼šç¤¾ãƒªã‚¹ãƒˆ</h2>
    <form id="logout-form" action="{% url 'saleslist:logout' %}" method="post">
        {% csrf_token %}
        <button type="submit">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        <a href="{% url 'saleslist:dashboard' %}" class="btn btn-primary">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸</a>
        
    </form>

<!-- ğŸ”¹ æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  -->
<form method="GET" action="{% url 'saleslist:company_list' %}">
    <input type="text" name="query" placeholder="åº—èˆ—å" value="{{ query }}">
    <input type="text" name="phone" placeholder="é›»è©±ç•ªå·" value="{{ phone }}">
    <input type="text" name="address" placeholder="ä½æ‰€" value="{{ address }}">
    <input type="text" name="corporation_name" placeholder="æ³•äººå" value="{{ corporation_name }}">
    <input type="text" name="corporation_phone" placeholder="æ³•äººé›»è©±ç•ªå·" value="{{ corporation_phone }}">
    <input type="text" name="industry" placeholder="å¤§æ¥­ç¨®" value="{{ industry }}">
    <input type="text" name="sub_industry" placeholder="å°æ¥­ç¨®" value="{{ sub_industry }}">
    
    <label>æ´»å‹•æ—¥ (é–‹å§‹):</label>
    <input type="date" name="start_date" value="{{ start_date }}">

    <label>æ´»å‹•æ—¥ (çµ‚äº†):</label>
    <input type="date" name="end_date" value="{{ end_date }}">

    <label>å–¶æ¥­æ‹…å½“è€…:</label>
    <select name="sales_person">
        <option value="">ã™ã¹ã¦</option>
        {% for activity in sales_persons %}
            <option value="{{ activity.sales_person }}" {% if sales_person == activity.sales_person %}selected{% endif %}>
                {{ activity.sales_person }}
            </option>
        {% endfor %}
    </select>

    <label>å–¶æ¥­çµæœ:</label>
    <select name="result">
        <option value="">ã™ã¹ã¦</option>
        {% for res in results %}
            <option value="{{ res }}" {% if result == res %}selected{% endif %}>{{ res }}</option>
        {% endfor %}
    </select>

    <label>æ¬¡å›å–¶æ¥­äºˆå®šæ—¥ (é–‹å§‹):</label>
    <input type="date" name="next_action_start" value="{{ next_action_start }}">

    <label>æ¬¡å›å–¶æ¥­äºˆå®šæ—¥ (çµ‚äº†):</label>
    <input type="date" name="next_action_end" value="{{ next_action_end }}">

    <button type="submit">æ¤œç´¢</button>
</form>


<button type="button" class="btn btn-secondary" onclick="window.location.href='?sort=id&order=asc'">
    ã‚½ãƒ¼ãƒˆè§£é™¤
</button>

    <table>
        <tr>
            <th>
                <a href="?sort=name&order={% if sort_column == 'name' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">
                    åº—èˆ—å {% if sort_column == "name" %}{% if sort_order == "asc" %}â–²{% else %}â–¼{% endif %}{% endif %}
                </a>
            </th>
            <th>
                <a href="?sort=phone&order={% if sort_column == 'phone' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">
                    åº—èˆ—é›»è©±ç•ªå· {% if sort_column == "phone" %}{% if sort_order == "asc" %}â–²{% else %}â–¼{% endif %}{% endif %}
                </a>
            </th>
            <th class="address">
                <a href="?sort=address&order={% if sort_column == 'address' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">
                    åº—èˆ—ä½æ‰€ {% if sort_column == "address" %}{% if sort_order == "asc" %}â–²{% else %}â–¼{% endif %}{% endif %}
                </a>
            </th>
            <th>
                <a href="?sort=corporation_name&order={% if sort_column == 'corporation_name' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">
                    æ³•äººå {% if sort_column == "corporation_name" %}{% if sort_order == "asc" %}â–²{% else %}â–¼{% endif %}{% endif %}
                </a>
            </th>
            <th><a href="?sort=corporation_address&order={% if sort_column == 'corporation_address' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">æ³•äººæ‰€åœ¨åœ°</a></th>
            <th>
                <a href="?sort=activity_date&order={% if sort_column == 'activity_date' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">
                    æ´»å‹•æ—¥ {% if sort_column == "activity_date" %}{% if sort_order == "asc" %}â–²{% else %}â–¼{% endif %}{% endif %}
                </a>
            </th>
            <th>
                <a href="?sort=sales_person&order={% if sort_column == 'sales_person' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">
                    å–¶æ¥­æ‹…å½“è€… {% if sort_column == "sales_person" %}{% if sort_order == "asc" %}â–²{% else %}â–¼{% endif %}{% endif %}
                </a>
            </th>
            <th>
                <a href="?sort=result&order={% if sort_column == 'result' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">
                    å–¶æ¥­çµæœ {% if sort_column == "result" %}{% if sort_order == "asc" %}â–²{% else %}â–¼{% endif %}{% endif %}
                </a>
            </th>
            <th>
                <a href="?sort=next_action_date&order={% if sort_column == 'next_action_date' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">
                    æ¬¡å›å–¶æ¥­äºˆå®šæ—¥ {% if sort_column == "next_action_date" %}{% if sort_order == "asc" %}â–²{% else %}â–¼{% endif %}{% endif %}
                </a>
            </th>
            <th>è©³ç´°</th>
        </tr>
        {% for company in companies %}
        <tr>
            <td>{{ company.name }}</td>
            <td>{{ company.phone }}</td>
            <td class="address">{{ company.address }}</td>
            <td>{{ company.corporation_name }}</td>
            <td>{{ company.corporation_address }}</td>

            {% with company.salesactivity_set.last as last_activity %}
            <td>{% if last_activity %}{{ last_activity.activity_date|date:"Y/m/d H:i" }}{% else %}ãªã—{% endif %}</td>
            <td>{% if last_activity %}{{ last_activity.sales_person }}{% else %}ãªã—{% endif %}</td>
            <td>{% if last_activity %}{{ last_activity.result }}{% else %}ãªã—{% endif %}</td>
            <td>{% if last_activity and last_activity.next_action_date %}
                {{ last_activity.next_action_date|date:"Y/m/d H:i" }}  <!-- âœ… æ™‚é–“ã¾ã§è¡¨ç¤º -->
                {% else %} ãªã— {% endif %}
            </td>
            {% endwith %}
            
            <td><a href="{% url 'saleslist:company_detail' company.id %}">è©³ç´°ã‚’è¦‹ã‚‹</a></td>

        </tr>
        {% empty %}
        <tr>
            <td colspan="9">è©²å½“ã™ã‚‹ä¼šç¤¾ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</td>
        </tr>
        {% endfor %}
    </table>


</body>
</html>
