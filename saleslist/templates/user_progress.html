{% extends "base.html" %}
{% block content %}
{% load humanize %}
{% load custom_filters %}

<div class="container mt-4">
  <h3>é€²æ—ç®¡ç†ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆï¼‰</h3>

  <form method="get" class="row g-2 align-items-end mb-3">
    <div class="col-md-3">
      <label for="month">å¯¾è±¡æœˆ:</label>
      <input type="month" class="form-control" name="month" id="month" value="{{ month }}">
    </div>
    <div class="col-md-5">
      <label for="q">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢:</label>
      <input type="text" class="form-control" name="q" placeholder="é¡§å®¢åã‚„å•†æãªã©" value="{{ query }}">
    </div>
    <div class="col-md-2">
      <button type="submit" class="btn btn-primary w-100">æ¤œç´¢</button>
    </div>
    <div class="alert alert-info d-flex align-items-center" role="alert">
      <i class="bi bi-check-circle-fill me-2"></i>
      âœ… ã“ã®æœˆã®å®Œäº†ç²—åˆ©åˆè¨ˆï¼š{{ gross_profit_sum|intcomma }} å††
    </div>
  </form>

  <table class="table table-striped table-bordered table-sm">
    <thead class="table-light">
      <tr>
        <th>å—æ³¨æ—¥</th>
        <th>å®Œäº†æ—¥</th>
        <th>é¡§å®¢å</th>
        <th>ã‚¢ãƒæ‹…å½“</th>
        <th>å–¶æ¥­æ‹…å½“</th>
        <th>ç²å¾—å•†æ</th>
        <th>ç²å¾—ãƒ—ãƒ©ãƒ³</th>
        <th>å¥‘ç´„å®¹é‡</th>
        <th>ç²å¾—ä½¿ç”¨é‡</th>
        <th>ç²—åˆ©</th>
        <th>ï½·ï½¬ï½¯ï½¼ï½­ï¾Šï¾ï½¯ï½¸</th>
        <th>æ‰‹æ•°æ–™</th>
        <th>é€²æ—</th>
      </tr>
    </thead>
    <tbody>
      {% for profile in profiles %}
        <tr {% if profile.progress|default_if_none:""|cut:" "|cut:"ã€€" == "å®Œäº†" %} style="background-color: #d1ecf1;" {% endif %}>
            <td>{{ profile.order_date }}</td>
            <td>{{ profile.complete_date }}</td>
            <td>{{ profile.customer_name }}</td>
            <td>{{ profile.appointment_staff }}</td>
            <td>{{ profile.sales_staff }}</td>
            <td>{{ profile.product }}</td>
            <td>{{ profile.plan }}</td>
            <td>{{ profile.capacity }}</td>
            <td>{{ profile.acquired_usage }}</td>
            <td>{{ profile.gross_profit }}</td>
            <td>{{ profile.cashback }}</td>
            <td>{{ profile.commission }}</td>
            <td>
              <form method="POST">
                {% csrf_token %}
                <input type="hidden" name="user_id" value="{{ profile.id }}">
                <div class="d-flex align-items-center gap-1">
                  <select name="progress" class="form-select form-select-sm" style="width: auto;">
                    {% for option in progress_choices %}
                      <option value="{{ option }}" {% if profile.progress == option %}selected{% endif %}>{{ option }}</option>
                    {% endfor %}
                  </select>
                  <input type="hidden" name="profile_id" value="{{ profile.id }}">

                  <!-- ğŸ”½ ç¾åœ¨ã®GETãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ hidden ã§ä¿æŒ -->
                  {% for key, value in request.GET.items %}
                    <input type="hidden" name="{{ key }}" value="{{ value }}">
                  {% endfor %}

                  <button type="submit" class="btn btn-sm btn-primary">æ›´æ–°</button>
                </div>
              </form>
            </td>
          </tr>
      {% empty %}
      <tr><td colspan="13">è©²å½“ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
